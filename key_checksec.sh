#! /bin/bash

V_RELRO="not defined"
V_STACK_CANARY="not defined"
V_NX="not defined"
V_PIE="not defined"
V_FORTIFIED_CNT="not defined"
V_FORTIFIABLE_CNT="not defined"
V_FORTIFY="not defined"

export V_RELRO
export V_STACK_CANARY
export V_NX
export V_PIE
export V_FORTIFIED_CNT
export V_FORTIFIABLE_CNT
export V_FORTIFY


. ~/Project/mytool/checksec.sh-master/checksec --file=$1 > /dev/null

#print the directory
echo $1
#print the mitigation exploit details of the binary file
echo "$V_RELRO | $V_STACK_CANARY | $V_NX | $V_PIE | $V_FORTIFY | Fortified=$V_FORTIFIED_CNT | Fortifiable=$V_FORTIFIABLE_CNT"

#RELRO FILES
if [ "$V_RELRO" = "Full RELRO" ]; then
	echo $1 >> ~/Project/mytool/result/relro/full_relro.txt
fi
if [ "$V_RELRO" = "Partial RELRO" ]; then
	echo $1 >> ~/Project/mytool/result/relro/partial_relro.txt
fi
if [ "$V_RELRO" = "No RELRO" ]; then
	echo $1 >> ~/Project/mytool/result/relro/no_relro.txt
fi

#STACK CANARIES FILES
if [ "$V_STACK_CANARY" = "Stack Canary found" ]; then
	echo $1 >> ~/Project/mytool/result/stackcanaries/stack_canaries.txt
fi
if [ "$V_STACK_CANARY" = "No Stack Canary" ]; then
	echo $1 >> ~/Project/mytool/result/stackcanaries/no_stack_canaries.txt
fi

#NX
if [ "$V_NX" = "NX enabled" ]; then
	echo $1 >> ~/Project/mytool/result/nx/nx.txt
fi
if [ "$V_NX" = "NX disabled" ]; then
	echo $1 >> ~/Project/mytool/result/nx/no_nx.txt
fi

#PIE
if [ "$V_PIE" = "PIE enabled" ]; then
	echo $1 >> ~/Project/mytool/result/pie/pie.txt
fi
if [ "$V_PIE" = "No PIE" ]; then
	echo $1 >> ~/Project/mytool/result/pie/no_pie.txt
fi

#FORTIFY SOURCE
if [ "$V_FORTIFY" = "FORTIFY SOURCE: Yes" ]; then
	echo $1 >> ~/Project/mytool/result/fortify_source/fortify_source.txt
fi
if [ "$V_FORTIFY" = "FORTIFY SOURCE: No" ]; then
	echo $1 >> ~/Project/mytool/result/fortify_source/no_fortify_source.txt
fi
